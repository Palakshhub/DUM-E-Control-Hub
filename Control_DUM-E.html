<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DUM-E Control Hub</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');

html, body {
  height: 100%;
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  background:
    radial-gradient(circle at top, #8b0000, #000),
    repeating-linear-gradient(
      45deg,
      rgba(255,0,0,0.05) 0,
      rgba(255,0,0,0.05) 1px,
      transparent 1px,
      transparent 20px
    );
  overflow: hidden;
}

.spider-card {
  width: 100vw;
  height: 100vh;
  backdrop-filter: blur(10px);
  display: flex;
  justify-content: center;
  align-items: center;
}

.controls {
  background: rgba(0,0,0,0.6);
  border: 2px solid rgba(255,0,0,0.4);
  box-shadow: 0 0 25px rgba(255,0,0,0.6);
  padding: 1.5rem;
  border-radius: 1.2rem;
  text-align: center;
  width: 280px;
}

.joystick-base {
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, #400, #000);
  border: 2px solid red;
  border-radius: 50%;
  position: relative;
  margin: auto;
  touch-action: none;
}

.joystick-stick {
  width: 60px;
  height: 60px;
  background: radial-gradient(circle, #ff3333, #8b0000);
  border-radius: 50%;
  position: absolute;
  top: 30px;
  left: 30px;
  box-shadow: 0 0 15px red;
}

button {
  transition: 0.15s ease;
}

button:hover {
  transform: scale(1.08);
  box-shadow: 0 0 12px rgba(255,0,0,0.6);
}
</style>
</head>

<body class="text-white">
<main class="spider-card">
  <div class="controls space-y-4">
    <h1 class="text-3xl font-bold text-red-500 tracking-widest">DUM-E</h1>

    <button id="connectBtn" class="bg-red-700 px-6 py-2 rounded-lg font-semibold">
      ðŸ”Œ CONNECT
    </button>

    <div class="joystick-base" id="joystickBase">
      <div class="joystick-stick" id="joystickStick"></div>
    </div>

    <button id="sitBtn" class="bg-red-800 py-2 rounded-lg w-full">SIT</button>
    <button id="standBtn" class="bg-green-700 py-2 rounded-lg w-full">STAND</button>
    <button id="waveBtn" class="bg-purple-700 py-2 rounded-lg w-full">WAVE</button>
  </div>
</main>

<script>
let txCharacteristic;
let espConnected = false;

const SERVICE_UUID = "12345678-1234-5678-1234-56789abcdef0";
const CHARACTERISTIC_UUID = "abcdef01-1234-5678-1234-56789abcdef0";

const sitBtn   = document.getElementById("sitBtn");
const standBtn = document.getElementById("standBtn");
const waveBtn  = document.getElementById("waveBtn");

document.getElementById("connectBtn").onclick = async () => {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: "DUM-E" }],
      optionalServices: [SERVICE_UUID]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    txCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);

    espConnected = true;
    alert("Connected âœ…");
  } catch {
    alert("Connection failed âš ");
  }
};

function send(cmd) {
  if (!espConnected) return;
  txCharacteristic.writeValue(new TextEncoder().encode(cmd));
}

/* BUTTONS */
sitBtn.onclick   = () => send("SIT");
standBtn.onclick = () => send("STAND");
waveBtn.onclick  = () => send("WAVE");

/* JOYSTICK */
const base = joystickBase;
const stick = joystickStick;
const maxDist = 40;
let active = false;

function centerStick() {
  stick.style.left = "30px";
  stick.style.top  = "30px";
  send("STOP");
}

function moveStick(x, y) {
  const rect = base.getBoundingClientRect();
  let dx = x - rect.left - 60;
  let dy = y - rect.top  - 60;

  const dist = Math.hypot(dx, dy);
  if (dist > maxDist) {
    dx = dx * maxDist / dist;
    dy = dy * maxDist / dist;
  }

  stick.style.left = 30 + dx + "px";
  stick.style.top  = 30 + dy + "px";

  if (Math.abs(dx) > Math.abs(dy)) {
    send(dx > 0 ? "RIGHT" : "LEFT");
  } else {
    send(dy > 0 ? "BACKWARD" : "FORWARD");
  }
}

base.onmousedown = () => active = true;
window.onmousemove = e => active && moveStick(e.clientX, e.clientY);
window.onmouseup = () => { active = false; centerStick(); };

base.ontouchstart = () => active = true;
base.ontouchmove = e => moveStick(e.touches[0].clientX, e.touches[0].clientY);
base.ontouchend = () => { active = false; centerStick(); };
</script>
</body>
</html>
